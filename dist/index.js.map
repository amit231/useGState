{"version":3,"file":"index.js","sources":["../src/index.tsx"],"sourcesContent":["import React, {\n  useCallback,\n  useContext,\n  useEffect,\n  useState\n} from 'react'\n\n\nconst StoreContext = React.createContext<\n  Partial<{\n    get: (a: string) => any\n    set: (a: string, v: object) => void\n    subscribe: (fn: () => void) => void\n    unsubscribe: (fn: () => void) => void\n  }>\n>({})\n\n\nconst store = {\n  current:{}\n};\nconst GStateContextProvider = StoreContext.Provider\ninterface IgState {\n  key: string\n  value: any\n}\n\nconst useGState = (gState: IgState) => {\n  const { get, set, subscribe, unsubscribe } = useContext(StoreContext)\n  const [state, setState] = useState(gState.value)\n\n  const setter = useCallback((val) => {\n    set?.(gState.key, val)\n  }, [])\n  useEffect(() => {\n    const subscriber = () => {\n      const updatedState = get?.(gState.key)\n      setState(()=>updatedState)\n    }\n    subscribe?.(subscriber)\n    return () => {\n      unsubscribe?.(subscriber)\n    }\n  }, [])\n\n  return [state, setter]\n}\n\nlet gStateCnt = 0\nconst gState = (value: any): IgState => {\n  const key = `gState#${++gStateCnt}`\n  store.current[key] = value;\n  return { key, value }\n}\nexport default useGState;\nconst premetiveTypes = ['number','string','bigInt','boolean']\nconst GStateProvider = ({ children }: { children: JSX.Element }) => {\n  const get = React.useCallback((a: string) => {\n    return store.current[a]\n  }, [])\n  const set = React.useCallback((a: string, val: any) => {\n    if(premetiveTypes.includes(typeof val)){\n      store.current[a] = val;\n    } else{\n      store.current[a] = { ...store.current[a], ...val }\n    }\n    subs.current.forEach(sub=>sub());\n  }, [])\n  const subs = React.useRef(new Set<() => void>())\n  const subscribe = React.useCallback((fn: () => void) => {\n    subs.current.add(fn)\n  }, [])\n  const unsubscribe = React.useCallback((fn: () => void) => {\n    subs.current.delete(fn)\n  }, [])\n  return (\n    <GStateContextProvider value={{ get, set, subscribe, unsubscribe }}>\n      {children}\n    </GStateContextProvider>\n  )\n}\n\nexport {GStateProvider,gState};\n"],"names":["StoreContext","React","createContext","store","current","GStateContextProvider","Provider","useGState","gState","useContext","get","set","subscribe","unsubscribe","useState","value","state","setState","setter","useCallback","val","key","useEffect","subscriber","updatedState","gStateCnt","premetiveTypes","GStateProvider","children","a","includes","subs","forEach","sub","useRef","Set","fn","add"],"mappings":"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"}